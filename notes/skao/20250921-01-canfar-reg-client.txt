#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2025, Manchester (http://www.manchester.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#zrq-notes-indent
#
# AIMetrics: []
#

    Target:

        Refactoring the registry client tests ....
        Aiming to bring everything into a single test class that implements lots of different tests.

    Result:

        Work in progress ...

# -----------------------------------------------------

    #
    # One bad registry, two good registries.
    MixedHostnamesDroppedConnectionTest

        request().withPath("/bad-registry-one/resource-caps")
            error().withDropConnection(true)

        request().withPath("/good-registry-one/resource-caps")
            response().withStatusCode(HttpStatus.SC_OK)
                .withBody("ivo://good.authority/good-service = http://localhost:1080/good-service/good-capabilities")

        request().withPath("/good-registry-two/resource-caps")
            response().withStatusCode(HttpStatus.SC_OK)
                .withBody("ivo://good.authority/good-service = http://localhost:1080/good-service/good-capabilities")

        request().withPath("/good-service/good-capabilities")
            response().withStatusCode(HttpStatus.SC_OK)
                .withHeader(new Header(HttpHeaders.CONTENT_TYPE, MediaType.XML_UTF_8.toString()))
                .withBody("<vosi:capabilities"..)

        new RegistryClient(
            makeConfigFile(
                "ca.nrc.cadc.reg.client.RegistryClient.baseURL = http://testhost-one:1080/bad-registry-one",
                "ca.nrc.cadc.reg.client.RegistryClient.baseURL = http://testhost-two:1080/good-registry-one",
                "ca.nrc.cadc.reg.client.RegistryClient.baseURL = http://testhost-three:1080/good-registry-two"
                )
            );

    testDroppedRegistryConnectionOnce

    testDroppedRegistryConnectionTwice

# -----------------------------------------------------

    #
    # Three bad registries.
    MultipleRegistriesDroppedConnectionTest.java

        request().withPath("/bad-registry-one/resource-caps")
            error().withDropConnection(true)

        request().withPath("/bad-registry-two/resource-caps")
            error().withDropConnection(true)

        request().withPath("/bad-registry-three/resource-caps")
            error().withDropConnection(true)

        new RegistryClient(
            makeConfigFile(
                "ca.nrc.cadc.reg.client.RegistryClient.baseURL = http://localhost:1080/bad-registry-one",
                "ca.nrc.cadc.reg.client.RegistryClient.baseURL = http://localhost:1080/bad-registry-two",
                "ca.nrc.cadc.reg.client.RegistryClient.baseURL = http://localhost:1080/bad-registry-three"
                )
            );



# -----------------------------------------------------

    SingleRegistryDroppedConnectionTest.java

        request().withPath("/bad-registry/resource-caps")
            error().withDropConnection(true)

        new RegistryClient(
            makeConfigFile(
              "ca.nrc.cadc.reg.client.RegistryClient.baseURL = http://localhost:1080/bad-registry"
                )
            );


# -----------------------------------------------------

MixedHostnamesResourceNotFoundTest.java
MixedHostnamesResponseTimeoutTest.java
MixedRegistriesDroppedConnectionTest.java
MixedRegistriesResourceNotFoundTest.java
MixedRegistriesResponseTimeoutTest.java
MixedRegistriesUnknownServiceTest.java

MultipleRegistriesBadCapabilitiesXmlTest.java
MultipleRegistriesCapabilitiesNotFoundTest.java
MultipleRegistriesGoodAvailabilityTest.java
MultipleRegistriesGoodCapabilitiesTest.java
MultipleRegistriesResourceNotFoundTest.java
MultipleRegistriesResponseTimeoutTest.java
MultipleRegistriesUnknownServiceTest.java

SingleRegistryBadCapabilitiesXmlTest.java
SingleRegistryCapabilitiesNotFoundTest.java
SingleRegistryGoodAvailabilityTest.java
SingleRegistryGoodCapabilitiesTest.java
SingleRegistryResourceNotFoundTest.java
SingleRegistryResponseTimeoutTest.java
SingleRegistryUnknownServiceTest.java


